<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>OPOBIO TRAINER ‚Äì Simulacros y Estudio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020617;
      --bg-outer: radial-gradient(circle at top, #1f2937, #020617);
      --bg-card: #020617;
      --bg-card-soft: #0b1220;
      --accent: #38bdf8;
      --accent-soft: #0ea5e9;
      --accent-strong: #1d4ed8;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border-soft: rgba(148, 163, 184, 0.35);
      --shadow-strong: 0 24px 90px rgba(15, 23, 42, 0.95);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg-outer);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 1rem;
    }

    /* Scrollbar bonita */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(55, 65, 81, 0.8);
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(75, 85, 99, 1);
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.18), transparent)
        , radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.18), transparent)
        , rgba(15, 23, 42, 0.96);
      border-radius: 1.6rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: var(--shadow-strong);
      padding: 1.5rem 1.8rem 2rem;
      backdrop-filter: blur(16px);
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      border-radius: inherit;
      border: 1px solid rgba(148, 163, 184, 0.1);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.2rem;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 0.18rem;
    }

    h1 {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 0.55rem;
    }

    h1 span.logo {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 20%, #22d3ee, #1d4ed8);
      box-shadow: 0 0 30px rgba(56, 189, 248, 0.7);
      font-weight: 900;
      font-size: 1rem;
      color: #0b1220;
    }

    h1 span.text {
      background: linear-gradient(to right, #e5e7eb, #38bdf8);
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 12px rgba(15, 23, 42, 0.8);
    }

    .subtitle {
      font-size: 0.82rem;
      color: var(--muted);
    }

    .file-loader {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.95),
        rgba(15, 23, 42, 0.85)
      );
      border-radius: 999px;
      padding: 0.5rem 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.9);
    }

    .file-loader label {
      font-size: 0.7rem;
      color: var(--muted);
      display: block;
    }

    .file-loader input[type="file"] {
      font-size: 0.75rem;
      color: var(--text);
      max-width: 200px;
      background: transparent;
    }

    .file-loader input[type="file"]::-webkit-file-upload-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      padding: 0.15rem 0.7rem;
      font-size: 0.7rem;
      margin-right: 0.4rem;
      cursor: pointer;
    }

    .file-loader input[type="file"]::file-selector-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      padding: 0.15rem 0.7rem;
      font-size: 0.7rem;
      margin-right: 0.4rem;
      cursor: pointer;
    }

    .pill {
      padding: 0.1rem 0.6rem;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.1);
      color: #bbf7d0;
      font-size: 0.7rem;
      border: 1px solid rgba(34, 197, 94, 0.4);
      white-space: nowrap;
    }

    .tabs {
      display: flex;
      gap: 0.4rem;
      margin-bottom: 1rem;
      margin-top: 0.5rem;
      border-bottom: 1px solid rgba(30, 64, 175, 0.55);
      padding-bottom: 0.15rem;
      position: relative;
      z-index: 1;
    }

    .tab {
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      font-size: 0.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      transition: background 0.15s, color 0.15s, transform 0.1s;
    }

    .tab span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.65);
    }

    .tab.active {
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.35), transparent);
      color: var(--accent);
      transform: translateY(-1px);
    }

    .tab.active span.dot {
      background: var(--accent);
      box-shadow: 0 0 6px rgba(56, 189, 248, 0.9);
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-bottom: 1rem;
      align-items: center;
      justify-content: space-between;
      position: relative;
      z-index: 1;
    }

    .toolbar-left {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
    }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 0.42rem 0.95rem;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: linear-gradient(to right, #0ea5e9, #1d4ed8);
      color: white;
      box-shadow: 0 10px 28px rgba(37, 99, 235, 0.55);
      transition: transform 0.1s, box-shadow 0.1s, opacity 0.1s;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 36px rgba(37, 99, 235, 0.7);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.7);
      opacity: 0.95;
    }

    .btn.secondary {
      background: rgba(15, 23, 42, 0.95);
      box-shadow: none;
      border: 1px solid rgba(148, 163, 184, 0.65);
      color: var(--muted);
    }

    .btn.secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .content {
      max-height: calc(100vh - 210px);
      overflow: auto;
      padding-right: 0.4rem;
      position: relative;
      z-index: 1;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
      gap: 0.9rem;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.98));
      border-radius: 0.95rem;
      padding: 0.7rem;
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.85);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.08), transparent);
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card img {
      width: 100%;
      max-height: 220px;
      object-fit: contain;
      border-radius: 0.55rem;
      margin-bottom: 0.5rem;
      background: #000;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      font-size: 0.7rem;
      color: var(--muted);
    }

    .chip {
      padding: 0.12rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.98);
    }

    .chip.filo {
      border-color: var(--accent-soft);
      color: var(--accent-soft);
    }

    .names {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .nc {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .ncom {
      font-size: 0.8rem;
      color: var(--muted);
      font-style: italic;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      margin-top: 0.25rem;
    }

    .field-group label {
      font-size: 0.7rem;
      color: var(--muted);
    }

    .field-group input {
      width: 100%;
      padding: 0.25rem 0.4rem;
      font-size: 0.8rem;
      border-radius: 0.55rem;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: #020617;
      color: var(--text);
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    .field-group input:focus {
      outline: none;
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.8);
      background: #020617;
    }

    .badge {
      font-size: 0.65rem;
      padding: 0.15rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--muted);
      margin-left: 0.3rem;
    }

    .badge.correcto {
      color: #bbf7d0;
      border-color: rgba(34, 197, 94, 0.7);
      background: rgba(22, 163, 74, 0.15);
    }

    .badge.incorrecto {
      color: #fecaca;
      border-color: rgba(248, 113, 113, 0.7);
      background: rgba(185, 28, 28, 0.2);
    }

    .res-correcta {
      font-size: 0.7rem;
      color: #bbf7d0;
      margin-top: 0.15rem;
    }

    .stats {
      margin-top: 0.7rem;
      padding-top: 0.6rem;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      font-size: 0.8rem;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }

    .stats strong {
      color: var(--accent);
    }

    .empty {
      text-align: center;
      padding: 2rem 0.5rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* Tarjetas grandes de Reino / Grupo grande */
    .tax-card {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      align-items: flex-start;
      justify-content: center;
      min-height: 115px;
      transition: transform 0.12s, box-shadow 0.12s, border-color 0.12s;
    }

    .tax-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.95);
      border-color: var(--accent-soft);
    }

    .tax-title {
      font-weight: 600;
      font-size: 1rem;
    }

    .tax-subtitle {
      font-size: 0.8rem;
      color: var(--muted);
    }

    /* Estudio sticky header */
    #vista-estudio {
      position: relative;
    }

    #estudio-header {
      position: sticky;
      top: 0;
      z-index: 5;
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.98),
        rgba(15, 23, 42, 0.96)
      );
      padding-bottom: 0.4rem;
      margin-bottom: 0.4rem;
      border-bottom: 1px solid rgba(30, 64, 175, 0.6);
    }

    .breadcrumb {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .breadcrumb a {
      cursor: pointer;
      color: var(--accent-soft);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    @media (max-width: 700px) {
  .app {
    padding: 1.2rem 1.05rem 1.6rem;
    border-radius: 1.2rem;
  }
  header {
    flex-direction: column;
    align-items: flex-start;
  }
  .file-loader {
    width: 100%;
    justify-content: space-between;
  }
  .content {
    max-height: calc(100vh - 250px);
  }
}  /* aqu√≠ se cierra el @media correctamente */


/* Tarjetas de reinos con imagen de fondo */
.tax-card.reino-animales {
  background-image:
    linear-gradient(to bottom, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.95)),
    url('img/reino-animales.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.reino-plantas {
  background-image:
    linear-gradient(to bottom, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.95)),
    url('img/reino-plantas.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.reino-hongos {
  background-image:
    linear-gradient(to bottom, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.95)),
    url('img/reino-hongos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.reino-otros {
  background-image:
    linear-gradient(to bottom, rgba(15, 23, 42, 0.4), rgba(15, 23, 42, 0.95)),
    url('img/reino-otros.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.reino-animales .tax-subtitle,
.tax-card.reino-plantas .tax-subtitle,
.tax-card.reino-hongos .tax-subtitle,
.tax-card.reino-otros .tax-subtitle {
  color: #cbd5f5; /* subt√≠tulo un poco m√°s claro */
}
/* ===== Fondos para grupos dentro de cada reino ===== */

.tax-card.grupo-anfibios {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-anfibios.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-aves {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-aves.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-cnidarios {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-cnidarios.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-equinodermos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-equinodermos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-gusanos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-gusanos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-insectos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-insectos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-mamiferos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-mamiferos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-moluscos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-moluscos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-otros-animales {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-otros-animales.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-peces {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-peces.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-poriferos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-poriferos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-reptiles {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-reptiles.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-ascomicetos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-ascomicetos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-basidiomicetos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-basidiomicetos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-otros {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-otros.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-algas {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-algas.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-angiospermas {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-angiospermas.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-gimnospermas {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-gimnospermas.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-helechos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-helechos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

.tax-card.grupo-musgos {
  background-image:
    linear-gradient(to bottom, rgba(15,23,42,0.4), rgba(15,23,42,0.95)),
    url('img/grupo-musgos.png');
  background-size: cover;
  background-position: center;
  color: #e5e7eb;
}

/* Subt√≠tulos un pel√≠n m√°s claros */
.tax-card[class*="grupo-"] .tax-subtitle {
  color: #cbd5f5;
}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title-block">
        <h1>
  <span class="logo">O</span>
  <span class="text">OPOBIO TRAINER</span>
</h1>

        <div class="subtitle">
          Simulacros de identificaci√≥n ¬∑ Animales, Plantas y Hongos
        </div>
      </div>
      <div class="file-loader">
        <div>
          <div style="font-size:0.8rem;color:var(--text);">1. Carga el JSON validado</div>
          <label for="jsonFile">especimenes_validado.json</label>
        </div>
        <input type="file" id="jsonFile" accept=".json" />
        <span class="pill">Datos cargados localmente</span>
      </div>
    </header>

        <div class="tabs">
      <button class="tab active" data-tab="simulacro">
        <span class="dot"></span>
        Simulacro (20 √≠tems)
      </button>
      <button class="tab" data-tab="estudio">
        <span class="dot"></span>
        Cat√°logo de estudio
      </button>
      <button class="tab" data-tab="proximamente">
        <span class="dot"></span>
        Pr√≥ximamente
      </button>
    </div>

    <div class="toolbar">
      <div class="toolbar-left" id="toolbar-simulacro">
        <button class="btn" id="btn-nuevo-simulacro">
          üîÅ Nuevo simulacro (20)
        </button>
        <button class="btn secondary" id="btn-corregir">
          ‚úÖ Corregir simulacro
        </button>
      </div>

      <div class="toolbar-left" id="toolbar-estudio" style="display:none;font-size:0.8rem;color:var(--muted);">
        Estudio por grupos grandes ¬∑ <strong style="color:var(--accent);">Animales</strong> ¬∑
        <strong style="color:var(--accent);">Plantas</strong> ¬∑
        <strong style="color:var(--accent);">Hongos</strong>.
      </div>
    </div>

    <div class="content">
      <div id="vista-simulacro">
        <div class="empty" id="mensaje-sin-datos">
          Carga primero el archivo <strong>especimenes_validado.json</strong> para generar un simulacro.
        </div>
        <div class="grid" id="grid-simulacro" style="display:none;"></div>
        <div id="stats-simulacro"></div>
      </div>

      <div id="vista-estudio" style="display:none;">
        <div id="estudio-header"></div>
        <div class="empty" id="mensaje-sin-datos-estudio">
          Carga primero el archivo <strong>especimenes_validado.json</strong> para ver el cat√°logo.
        </div>
        <div class="grid" id="grid-estudio" style="display:none;"></div>
      </div>
      <div id="vista-proximamente" style="display:none;">
        <div class="section-title">Pr√≥ximamente</div>
        <div class="breadcrumb">
          Aqu√≠ llegar√°n nuevos m√≥dulos para completar tu preparaci√≥n.
        </div>

        <div class="grid">
          <div class="card tax-card">
            <div class="tax-title">Rocas</div>
            <div class="tax-subtitle">
              Identificaci√≥n visual de rocas: √≠gneas, metam√≥rficas y sedimentarias.
           
            </div>
          </div>

          <div class="card tax-card">
            <div class="tax-title">F√≥siles</div>
            <div class="tax-subtitle">
              Reconocimiento de f√≥siles gu√≠a y principales grupos paleontol√≥gicos.
            </div>
          </div>

          <div class="card tax-card">
            <div class="tax-title">Histolog√≠a</div>
            <div class="tax-subtitle">
              Cortes histol√≥gicos b√°sicos: tejidos animales y vegetales,
              estructuras clave para la parte microsc√≥pica del VISU.
            </div>
          </div>

          <div class="card tax-card">
            <div class="tax-title">Ejercicios pr√°cticos</div>
            <div class="tax-subtitle">
              Prep√°rate de forma econ√≥mica la parte pr√°ctica, m√°s de 1000 ejercicios de gen√©tica, ecolog√≠a, geolog√≠a, etc. Resueltos paso a paso.
            </div>
          </div>
        </div>
      </div>
        <div class="card tax-card">
          <div class="tax-title">Sugerencias y rese√±as</div>
          <div class="tax-subtitle">
            Cu√©ntanos qu√© mejorar, qu√© grupos te gustar√≠a que a√±adamos
            o c√≥mo te est√° ayudando OPOBIO TRAINER en tu preparaci√≥n.
          </div>
          <a
            href="https://forms.gle/TU_ENLACE_DE_FORM"
            target="_blank"
            rel="noopener noreferrer"
            style="
              margin-top: 0.6rem;
              font-size: 0.8rem;
              color: #38bdf8;
              text-decoration: none;
              padding: 0.25rem 0.7rem;
              border-radius: 999px;
              border: 1px solid rgba(56, 189, 248, 0.7);
              display: inline-block;
            "
          >
            Abrir formulario de sugerencias ‚Üí
          </a>
        </div>

    </div>
  </div>

  <script>
    // --- Estado global ---
    let especimenes = [];
    let simulacroActual = [];
    let resultadosSimulacro = null;

    // Estudio: Reino -> Grupo grande
    let estudioReinoSeleccionado = null;   // "Animales", "Plantas", "Hongos", "Otros"
    let estudioGrupoSeleccionado = null;   // "Aves", "Mam√≠feros", "Algas", etc.

    // Traducciones taxon√≥micas informativas
    const TRAD_FILO = {
      'Chordata': 'Cordados',
      'Arthropoda': 'Artr√≥podos',
      'Mollusca': 'Moluscos',
      'Annelida': 'An√©lidos',
      'Nematoda': 'Nematodos',
      'Platyhelminthes': 'Platelmintos',
      'Cnidaria': 'Cnidarios',
      'Echinodermata': 'Equinodermos',
      'Porifera': 'Por√≠feros',
      'Bryophyta': 'Briofitas',
      'Pteridophyta': 'Pterid√≥fitos',
      'Magnoliophyta': 'Angiospermas',
      'Pinophyta': 'Gimnospermas',
      'Ascomycota': 'Ascomicetos',
      'Basidiomycota': 'Basidiomicetos'
    };

    const TRAD_CLASE = {
      'Mammalia': 'Mam√≠feros',
      'Aves': 'Aves',
      'Reptilia': 'Reptiles',
      'Amphibia': 'Anfibios',
      'Actinopterygii': 'Peces √≥seos',
      'Chondrichthyes': 'Peces cartilaginosos',
      'Insecta': 'Insectos',
      'Arachnida': 'Ar√°cnidos',
      'Gastropoda': 'Gaster√≥podos',
      'Bivalvia': 'Bivalvos',
      'Cephalopoda': 'Cefal√≥podos'
    };

    function etiquetaFilo(filo) {
      if (!filo) return 'Filo n/d';
      const es = TRAD_FILO[filo];
      return es ? `${filo} ¬∑ ${es}` : filo;
    }

    function etiquetaClase(clase) {
      if (!clase) return 'Clase n/d';
      const es = TRAD_CLASE[clase];
      return es ? `${clase} ¬∑ ${es}` : clase;
    }

    // --- Agrupaci√≥n en REINO grande ---
    function obtenerReinoGrupo(e) {
      const reinoRaw = (e.reino || '').toLowerCase().trim();
      const filo     = (e.filo  || '').toLowerCase().trim();

      // Filos t√≠picos de algas
      const algaePhyla = [
        'chlorophyta',     // algas verdes
        'rhodophyta',      // algas rojas
        'ochrophyta',      // algas pardas y afines
        'phaeophyceae',    // algas pardas (como clase)
        'bacillariophyta', // diatomeas
        'dinophyta',       // dinoflagelados
        'myzozoa',         // grupo que incluye muchos dinoflagelados
        'charophyta'       // algas verdes cercanas a plantas terrestres
      ];

      // Animales / Plantas / Hongos claros
      if (reinoRaw === 'animalia') return 'Animales';
      if (reinoRaw === 'plantae')  return 'Plantas';
      if (reinoRaw === 'fungi')    return 'Hongos';

      // Algas que vienen como Chromista, Protista o sin reino claro
      const esAlga = algaePhyla.some(p => filo === p || filo.includes(p));
      if (reinoRaw === 'chromista' || reinoRaw === 'protista' || esAlga) {
        return 'Plantas'; // a efectos de estudio las metemos en bloque Plantas
      }

      // Resto de cosas raras (bacterias, etc.)
      return 'Otros';
    }

    // --- Agrupaci√≥n en GRUPOS grandes dentro de cada reino ---
    function obtenerGrupoGrande(e) {
      const reino = obtenerReinoGrupo(e);        // Animales / Plantas / Hongos / Otros
      const filo  = (e.filo  || '').toLowerCase().trim();
      const clase = (e.clase || '').toLowerCase().trim();
      const orden = (e.orden || '').toLowerCase().trim();
      const nombreComun = (e.nombre_comun || '').toLowerCase();

      // --- ANIMALES ---
      if (reino === 'Animales') {
        // Mam√≠feros
        if (clase === 'mammalia') return 'Mam√≠feros';

        // Aves
        if (clase === 'aves') return 'Aves';

        // Anfibios
        if (clase === 'amphibia') return 'Anfibios';

        // Reptiles: clase Reptilia, √≥rdenes t√≠picos o nombre com√∫n
        if (
          clase === 'reptilia' ||
          ['testudines', 'squamata', 'crocodylia'].includes(orden) ||
          nombreComun.includes('tortuga') ||
          nombreComun.includes('serp') ||    // serpiente, serpi...
          nombreComun.includes('v√≠bora') ||
          nombreComun.includes('vibora') ||
          nombreComun.includes('culebra') ||
          nombreComun.includes('cocodril') ||
          nombreComun.includes('lagarto')
        ) {
          return 'Reptiles';
        }

        // Peces: clases de peces, √≥rdenes t√≠picos o nombre com√∫n "pez ..."
        if (
          clase === 'actinopterygii' ||
          clase === 'chondrichthyes' ||
          ['perciformes','cypriniformes','salmoniformes','gadiformes'].includes(orden) ||
          nombreComun.startsWith('pez') ||
          nombreComun.includes(' pez')
        ) {
          return 'Peces';
        }

        // Cnidarios, Por√≠feros, Moluscos, Equinodermos
        if (filo === 'cnidaria')      return 'Cnidarios';
        if (filo === 'porifera')      return 'Por√≠feros';
        if (filo === 'mollusca')      return 'Moluscos';
        if (filo === 'echinodermata') return 'Equinodermos';

        // Insectos (y metemos aqu√≠ tambi√©n ar√°cnidos, como acordamos)
        if (filo === 'arthropoda') {
          return 'Insectos';
        }

        // Gusanos: an√©lidos, nematodos, platelmintos
        if (filo === 'annelida' || filo === 'nematoda' || filo === 'platyhelminthes') {
          return 'Gusanos';
        }

        // Filo chordata que no es mam√≠fero, ave, anfibio ni reptil ‚Üí lo tratamos como pez por simplificar VISU
        if (filo === 'chordata') {
          return 'Peces';
        }

        return 'Otros animales';
      }

      // --- PLANTAS ---
      if (reino === 'Plantas') {
        // Algas (muchas vienen de Chromista/Protista pero ya les hemos puesto reino=Plantas)
        if (
          filo === 'chlorophyta' ||
          filo === 'rhodophyta' ||
          filo === 'ochrophyta' ||
          filo === 'phaeophyceae' ||
          filo === 'bacillariophyta' ||
          filo === 'dinophyta' ||
          filo === 'myzozoa' ||
          filo === 'charophyta'
        ) {
          return 'Algas';
        }

        // Musgos / briofitas en general
        if (
          filo === 'bryophyta' ||
          filo.includes('bryoph') ||
          filo.includes('marchantioph')
        ) {
          return 'Musgos';
        }
 // Helechos y afines (pterid√≥fitas, licopodios, equisetos)
        if (
          filo === 'pteridophyta' ||
          filo === 'polypodiophyta' ||
          filo === 'monilophyta' ||
          filo === 'lycophyta' ||
          filo === 'lycopodiophyta' ||
          filo === 'equisetophyta' ||
          clase === 'polypodiopsida' ||
          clase === 'lycopodiopsida' ||
          clase === 'equisetopsida'
        ) {
          return 'Helechos y afines';
        }

        // Angiospermas (plantas con flor)
        if (
          filo === 'magnoliophyta' ||
          filo === 'angiospermae' ||
          // muchos registros modernos usan Tracheophyta como filo
          (filo === 'tracheophyta' && !['pinopsida','ginkgopsida','cycadopsida'].includes(clase))
        ) {
          return 'Angiospermas';
        }

        // Gimnospermas (con√≠feras, ginkgos, c√≠cadas)
        if (
          filo === 'pinophyta' ||
          filo === 'coniferophyta' ||
          (filo === 'tracheophyta' && ['pinopsida','ginkgopsida','cycadopsida'].includes(clase))
        ) {
          return 'Gimnospermas';
        }

        return 'Otras plantas';
      }

      // --- HONGOS ---
      if (reino === 'Hongos') {
        if (filo === 'ascomycota')    return 'Ascomicetos';
        if (filo === 'basidiomycota') return 'Basidiomicetos';
        return 'Otros hongos';
      }

      // Resto
      return 'Otros';
    }

    // --- DOM refs ---
    const fileInput = document.getElementById('jsonFile');
    const tabs = document.querySelectorAll('.tab');
    const vistaSimulacro = document.getElementById('vista-simulacro');
    const vistaEstudio = document.getElementById('vista-estudio');
    const toolbarSimulacro = document.getElementById('toolbar-simulacro');
    const toolbarEstudio = document.getElementById('toolbar-estudio');
    const vistaProximamente = document.getElementById('vista-proximamente');


    const gridSimulacro = document.getElementById('grid-simulacro');
    const gridEstudio = document.getElementById('grid-estudio');
    const mensajeSinDatos = document.getElementById('mensaje-sin-datos');
    const mensajeSinDatosEstudio = document.getElementById('mensaje-sin-datos-estudio');
    const statsSimulacro = document.getElementById('stats-simulacro');
    const btnNuevoSimulacro = document.getElementById('btn-nuevo-simulacro');
    const btnCorregir = document.getElementById('btn-corregir');
    const estudioHeader = document.getElementById('estudio-header');

    // --- Tabs ---
        tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const target = tab.dataset.tab;

        if (target === 'simulacro') {
          vistaSimulacro.style.display = '';
          vistaEstudio.style.display = 'none';
          vistaProximamente.style.display = 'none';
          toolbarSimulacro.style.display = 'flex';
          toolbarEstudio.style.display = 'none';
        } else if (target === 'estudio') {
          vistaSimulacro.style.display = 'none';
          vistaEstudio.style.display = '';
          vistaProximamente.style.display = 'none';
          toolbarSimulacro.style.display = 'none';
          toolbarEstudio.style.display = 'flex';
          renderEstudio();
        } else { // proximamente
          vistaSimulacro.style.display = 'none';
          vistaEstudio.style.display = 'none';
          vistaProximamente.style.display = '';
          toolbarSimulacro.style.display = 'none';
          toolbarEstudio.style.display = 'none';
        }
      });
    });


    // --- Carga JSON ---
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        try {
          const data = JSON.parse(ev.target.result);
          if (!Array.isArray(data)) {
            alert('El JSON debe ser un array de objetos.');
            return;
          }
          especimenes = data;
          mensajeSinDatos.style.display = 'none';
          mensajeSinDatosEstudio.style.display = 'none';
          gridEstudio.style.display = 'grid';
          gridSimulacro.style.display = 'none';
          statsSimulacro.innerHTML = '';
          resultadosSimulacro = null;
          simulacroActual = [];
          estudioReinoSeleccionado = null;
          estudioGrupoSeleccionado = null;
          alert('Datos cargados correctamente: ' + especimenes.length + ' espec√≠menes.');
          renderEstudio();
        } catch (err) {
          console.error(err);
          alert('Error al leer el JSON.');
        }
      };
      reader.readAsText(file);
    });

    // --- Util ---
    function normalizarTexto(str) {
      if (!str) return '';
      return String(str)
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .trim()
        .replace(/\s+/g, ' ');
    }

    // --- SIMULACRO ---
    btnNuevoSimulacro.addEventListener('click', nuevoSimulacro);
    btnCorregir.addEventListener('click', corregirSimulacro);

    function nuevoSimulacro() {
      if (!especimenes || especimenes.length === 0) {
        alert('Primero carga el archivo JSON.');
        return;
      }

      const copia = [...especimenes];
      for (let i = copia.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [copia[i], copia[j]] = [copia[j], copia[i]];
      }
      simulacroActual = copia.slice(0, 20);
      resultadosSimulacro = null;
      statsSimulacro.innerHTML = '';

      gridSimulacro.innerHTML = '';
      gridSimulacro.style.display = 'grid';

      simulacroActual.forEach((e, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.index = idx;

        if (e.image_url) {
          const img = document.createElement('img');
          img.src = e.image_url;
          img.alt = e.nombre_cientifico || e.nombre_comun || 'Imagen VISU';
          card.appendChild(img);
        }

        const chipRow = document.createElement('div');
        chipRow.className = 'chip-row';

        const catChip = document.createElement('span');
        catChip.className = 'chip';
        catChip.textContent = (e.categoria || 'desconocido').toUpperCase();
        chipRow.appendChild(catChip);

        const filoChip = document.createElement('span');
        filoChip.className = 'chip filo';
        filoChip.textContent = etiquetaFilo(e.filo || 'Filo n/d');
        chipRow.appendChild(filoChip);

        card.appendChild(chipRow);

        


        const fg1 = document.createElement('div');
        fg1.className = 'field-group';
        const l1 = document.createElement('label');
        l1.textContent = 'Nombre com√∫n:';
        const inputNcom = document.createElement('input');
        inputNcom.type = 'text';
        inputNcom.dataset.tipo = 'comun';
        inputNcom.dataset.index = idx;
        fg1.appendChild(l1);
        fg1.appendChild(inputNcom);
        card.appendChild(fg1);

        const fg2 = document.createElement('div');
        fg2.className = 'field-group';
        const l2 = document.createElement('label');
        l2.textContent = 'Nombre cient√≠fico:';
        const inputNc = document.createElement('input');
        inputNc.type = 'text';
        inputNc.dataset.tipo = 'cientifico';
        inputNc.dataset.index = idx;
        fg2.appendChild(l2);
        fg2.appendChild(inputNc);
        card.appendChild(fg2);

        gridSimulacro.appendChild(card);
      });
    }

    function corregirSimulacro() {
      if (simulacroActual.length === 0) {
        alert('Primero genera un simulacro.');
        return;
      }

      const inputs = gridSimulacro.querySelectorAll('input[type="text"]');
      let total = simulacroActual.length * 2;
      let aciertos = 0;

      const statsPorCategoria = {};

      simulacroActual.forEach((e, idx) => {
        const filaInputs = Array.from(inputs).filter(inp => Number(inp.dataset.index) === idx);
        const comunInp = filaInputs.find(i => i.dataset.tipo === 'comun');
        const cientInp = filaInputs.find(i => i.dataset.tipo === 'cientifico');

        const userComun = normalizarTexto(comunInp.value);
        const userCient = normalizarTexto(cientInp.value);

        const realComun = normalizarTexto(e.nombre_comun);
        const realCient = normalizarTexto(e.nombre_cientifico);

        const card = gridSimulacro.querySelector(`.card[data-index="${idx}"]`);
        card.querySelectorAll('.badge, .res-correcta').forEach(n => n.remove());

        function marcar(input, correcto, textoCorrecto, etiqueta) {
          const badge = document.createElement('span');
          badge.className = 'badge ' + (correcto ? 'correcto' : 'incorrecto');
          badge.textContent = etiqueta + (correcto ? ' ‚úî' : ' ‚úò');
          input.after(badge);

          if (!correcto) {
            const rc = document.createElement('div');
            rc.className = 'res-correcta';
            rc.textContent = 'Correcto: ' + textoCorrecto;
            badge.after(rc);
          }
        }

        let aciertosLocal = 0;

        if (realComun) {
          const ok = userComun === realComun;
          if (ok) aciertosLocal++;
          marcar(comunInp, ok, e.nombre_comun || '-', 'Com√∫n');
        } else {
          total -= 1;
        }

        if (realCient) {
          const ok2 = userCient === realCient;
          if (ok2) aciertosLocal++;
          marcar(cientInp, ok2, e.nombre_cientifico || '-', 'Cient√≠fico');
        } else {
          total -= 1;
        }

        aciertos += aciertosLocal;

        const cat = e.categoria || 'desconocido';
        if (!statsPorCategoria[cat]) {
          statsPorCategoria[cat] = { total: 0, aciertos: 0 };
        }
        statsPorCategoria[cat].total += 2;
        statsPorCategoria[cat].aciertos += aciertosLocal;
      });

      const porcentaje = total > 0 ? ((aciertos / total) * 100).toFixed(1) : 0;

      let html = `<div class="stats">
        <div><strong>${aciertos}</strong> / ${total} respuestas correctas (${porcentaje}%)</div>`;

      html += `<div>`;
      html += `Por categor√≠a: `;
      html += Object.entries(statsPorCategoria)
        .map(([cat, st]) => {
          const p = st.total > 0 ? ((st.aciertos / st.total) * 100).toFixed(0) : 0;
          return `<strong>${cat}</strong>: ${st.aciertos}/${st.total} (${p}%)`;
        })
        .join(' ¬∑ ');
      html += `</div></div>`;

      statsSimulacro.innerHTML = html;
    }

    // --- ESTUDIO: Reino -> Grupo grande -> Especies ---
    function renderEstudio() {
      if (!especimenes || especimenes.length === 0) {
        gridEstudio.style.display = 'none';
        mensajeSinDatosEstudio.style.display = '';
        estudioHeader.innerHTML = '';
        return;
      }

      mensajeSinDatosEstudio.style.display = 'none';
      gridEstudio.style.display = 'grid';
      gridEstudio.innerHTML = '';

      // Nivel 1: elegimos REINO grande
            if (!estudioReinoSeleccionado) {
        estudioHeader.innerHTML = `
          <div class="section-title">Elige un <strong>grupo de Reino</strong></div>
          <div class="breadcrumb">Nivel: Reino</div>
        `;

        gridEstudio.innerHTML = '';

        const mapaReinos = new Map();
        especimenes.forEach(e => {
          const r = obtenerReinoGrupo(e);
          if (!mapaReinos.has(r)) mapaReinos.set(r, 0);
          mapaReinos.set(r, mapaReinos.get(r) + 1);
        });

        const reinosOrdenados = Array.from(mapaReinos.entries())
          .sort((a, b) => a[0].localeCompare(b[0], 'es'));

        reinosOrdenados.forEach(([reino, count]) => {
          const card = document.createElement('div');
          card.className = 'card tax-card';

          // A√±adimos clase seg√∫n el reino para aplicar imagen de fondo
          const reinoLower = reino.toLowerCase();
          if (reinoLower === 'animales') {
            card.classList.add('reino-animales');
          } else if (reinoLower === 'plantas') {
            card.classList.add('reino-plantas');
          } else if (reinoLower === 'hongos') {
            card.classList.add('reino-hongos');
          } else {
            card.classList.add('reino-otros');
          }

          const title = document.createElement('div');
          title.className = 'tax-title';
          title.textContent = reino;

          const subtitle = document.createElement('div');
          subtitle.className = 'tax-subtitle';
          subtitle.textContent = `${count} espec√≠menes`;

          card.appendChild(title);
          card.appendChild(subtitle);

          card.addEventListener('click', () => {
            estudioReinoSeleccionado = reino;
            estudioGrupoSeleccionado = null;
            renderEstudio();
          });

          gridEstudio.appendChild(card);
        });

        return;
      }


          // Nivel 2: elegimos GRUPO grande dentro de ese Reino
    if (estudioReinoSeleccionado && !estudioGrupoSeleccionado) {
      estudioHeader.innerHTML = `
        <div class="section-title">Estudio: ${estudioReinoSeleccionado}</div>
        <div class="breadcrumb">
          <a id="crumb-reinos-n2">Reinos</a>
          <span>‚Ä∫</span>
          <span>${estudioReinoSeleccionado}</span>
        </div>
      `;

      // Hacer que el "Reinos" de nivel 2 vuelva al nivel 1
      const crumbN2 = document.getElementById('crumb-reinos-n2');
      if (crumbN2) {
        crumbN2.onclick = () => {
          estudioReinoSeleccionado = null;
          estudioGrupoSeleccionado = null;
          renderEstudio();
        };
      }

      gridEstudio.innerHTML = '';

      const mapaGrupos = new Map();
      especimenes.forEach(e => {
        if (obtenerReinoGrupo(e) !== estudioReinoSeleccionado) return;
        const g = obtenerGrupoGrande(e);
        if (!mapaGrupos.has(g)) mapaGrupos.set(g, 0);
        mapaGrupos.set(g, mapaGrupos.get(g) + 1);
      });

      const gruposOrdenados = Array.from(mapaGrupos.entries())
        .sort((a, b) => a[0].localeCompare(b[0], 'es'));

      gruposOrdenados.forEach(([grupo, count]) => {
        const card = document.createElement('div');
        card.className = 'card tax-card';

        // Asignar clase seg√∫n el nombre del grupo (en min√∫sculas)
        const gLower = grupo.toLowerCase();

        if (gLower === 'anfibios') {
          card.classList.add('grupo-anfibios');
        } else if (gLower === 'aves') {
          card.classList.add('grupo-aves');
        } else if (gLower === 'cnidarios') {
          card.classList.add('grupo-cnidarios');
        } else if (gLower === 'equinodermos') {
          card.classList.add('grupo-equinodermos');
        } else if (gLower === 'gusanos') {
          card.classList.add('grupo-gusanos');
        } else if (gLower === 'insectos') {
          card.classList.add('grupo-insectos');
        } else if (gLower === 'mam√≠feros' || gLower === 'mamiferos') {
          card.classList.add('grupo-mamiferos');
        } else if (gLower === 'moluscos') {
          card.classList.add('grupo-moluscos');
        } else if (gLower === 'otros animales') {
          card.classList.add('grupo-otros-animales');
        } else if (gLower === 'peces') {
          card.classList.add('grupo-peces');
        } else if (gLower === 'por√≠feros' || gLower === 'poriferos') {
          card.classList.add('grupo-poriferos');
        } else if (gLower === 'reptiles') {
          card.classList.add('grupo-reptiles');
        } else if (gLower === 'ascomicetos') {
          card.classList.add('grupo-ascomicetos');
        } else if (gLower === 'basidiomicetos') {
          card.classList.add('grupo-basidiomicetos');
        } else if (gLower === 'algas') {
          card.classList.add('grupo-algas');
        } else if (gLower === 'angiospermas') {
          card.classList.add('grupo-angiospermas');
        } else if (gLower === 'gimnospermas' || gLower === 'gumnospermas') {
          card.classList.add('grupo-gimnospermas');
        } else if (gLower.startsWith('helechos')) {
          card.classList.add('grupo-helechos');
        } else if (gLower === 'musgos') {
          card.classList.add('grupo-musgos');
        } else {
          card.classList.add('grupo-otros');
        }

        const title = document.createElement('div');
        title.className = 'tax-title';
        title.textContent = grupo;

        const subtitle = document.createElement('div');
        subtitle.className = 'tax-subtitle';
        subtitle.textContent = `${count} espec√≠menes`;

        card.appendChild(title);
        card.appendChild(subtitle);

        card.addEventListener('click', () => {
          estudioGrupoSeleccionado = grupo;
          renderEstudio();
        });

        gridEstudio.appendChild(card);
      });

      return;
    }

      // Nivel 3: lista de especies dentro de Reino + Grupo grande
      if (estudioReinoSeleccionado && estudioGrupoSeleccionado) {
        const lista = especimenes.filter(e =>
          obtenerReinoGrupo(e) === estudioReinoSeleccionado &&
          obtenerGrupoGrande(e) === estudioGrupoSeleccionado
        );

        estudioHeader.innerHTML = `
          <div class="section-title">
            Estudio: <strong>${estudioGrupoSeleccionado}</strong> (${estudioReinoSeleccionado})
          </div>
          <div class="breadcrumb">
            <a id="crumb-reinos">Reinos</a>
            <span>‚Ä∫</span>
            <a id="crumb-grupos">${estudioReinoSeleccionado}</a>
            <span>‚Ä∫</span>
            <span><strong>${estudioGrupoSeleccionado}</strong></span>
          </div>
        `;

        document.getElementById('crumb-reinos').onclick = () => {
          estudioReinoSeleccionado = null;
          estudioGrupoSeleccionado = null;
          renderEstudio();
        };
        document.getElementById('crumb-grupos').onclick = () => {
          estudioGrupoSeleccionado = null;
          renderEstudio();
        };

        gridEstudio.innerHTML = '';

        lista.forEach(e => {
          const card = document.createElement('div');
          card.className = 'card';

          if (e.image_url) {
            const img = document.createElement('img');
            img.src = e.image_url;
            img.alt = e.nombre_cientifico || e.nombre_comun || 'Imagen VISU';
            card.appendChild(img);
          }

          const chipRow = document.createElement('div');
          chipRow.className = 'chip-row';

          const reinoChip = document.createElement('span');
          reinoChip.className = 'chip';
          reinoChip.textContent = obtenerReinoGrupo(e);
          chipRow.appendChild(reinoChip);

          const grupoChip = document.createElement('span');
          grupoChip.className = 'chip';
          grupoChip.textContent = obtenerGrupoGrande(e);
          chipRow.appendChild(grupoChip);

          const filoChip = document.createElement('span');
          filoChip.className = 'chip filo';
          filoChip.textContent = etiquetaFilo(e.filo || 'Filo n/d');
          chipRow.appendChild(filoChip);

          card.appendChild(chipRow);

          const names = document.createElement('div');
          names.className = 'names';
          const nc = document.createElement('div');
          nc.className = 'nc';
          nc.textContent = e.nombre_cientifico || '-';
          const ncom = document.createElement('div');
          ncom.className = 'ncom';
          ncom.textContent = e.nombre_comun || '‚Äî';
          names.appendChild(nc);
          names.appendChild(ncom);
          card.appendChild(names);

          const tax = document.createElement('div');
          tax.className = 'chip-row';

          if (e.clase) {
            const spClase = document.createElement('span');
            spClase.className = 'chip';
            spClase.textContent = 'Clase: ' + etiquetaClase(e.clase);
            tax.appendChild(spClase);
          }

          if (e.orden) {
            const spOrden = document.createElement('span');
            spOrden.className = 'chip';
            spOrden.textContent = 'Orden: ' + e.orden;
            tax.appendChild(spOrden);
          }

          if (e.familia) {
            const spFam = document.createElement('span');
            spFam.className = 'chip';
            spFam.textContent = 'Familia: ' + e.familia;
            tax.appendChild(spFam);
          }

          card.appendChild(tax);
          // Cr√©ditos de imagen (autor, licencia)
          if (e.image_author || e.image_license || e.image_page_url) {
            const cred = document.createElement('div');
            cred.style.fontSize = '0.65rem';
            cred.style.color = '#9ca3af';
            cred.style.marginTop = '0.25rem';

            let texto = 'Foto: ';
            texto += e.image_author ? e.image_author : 'Autor no indicado';
            if (e.image_license) {
              texto += ' ¬∑ Licencia ' + e.image_license;
            }
            cred.textContent = texto;

            if (e.image_page_url) {
              const link = document.createElement('a');
              link.href = e.image_page_url;
              link.target = '_blank';
              link.rel = 'noopener noreferrer';
              link.style.display = 'inline-block';
              link.style.marginLeft = '0.3rem';
              link.style.color = '#38bdf8';
              link.style.textDecoration = 'none';
              link.textContent = '(Ver en Wikimedia)';
              cred.appendChild(link);
            }

            card.appendChild(cred);
          }

          gridEstudio.appendChild(card);

        });
      }
    }
// === Cargar autom√°ticamente el JSON de DEMO si existe ===
async function cargarDemoPorDefecto() {
  try {
    const resp = await fetch('especimenes_demo.json', { cache: 'no-store' });
    if (!resp.ok) {
      console.log('No se encontr√≥ especimenes_demo.json, se mantiene modo "cargar archivo".');
      return;
    }

    const data = await resp.json();
    if (!Array.isArray(data)) {
      console.log('El JSON de demo no es un array, se ignora.');
      return;
    }

    // Misma l√≥gica que al cargar archivo a mano
    especimenes = data;
    mensajeSinDatos.style.display = 'none';
    mensajeSinDatosEstudio.style.display = 'none';
    gridEstudio.style.display = 'grid';
    gridSimulacro.style.display = 'none';
    statsSimulacro.innerHTML = '';
    resultadosSimulacro = null;
    simulacroActual = [];
    estudioReinoSeleccionado = null;
    estudioGrupoSeleccionado = null;

    console.log('Demo cargada autom√°ticamente: ' + especimenes.length + ' espec√≠menes.');
    renderEstudio();
  } catch (e) {
    console.log('No se pudo cargar la demo por defecto:', e);
  }
}

// Al cargar la p√°gina intentamos cargar la demo
window.addEventListener('DOMContentLoaded', () => {
  cargarDemoPorDefecto();
});

  </script>
</body>
</html>
